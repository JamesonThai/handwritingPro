{% extends 'layout.html' %}
{% block body %}
	<div class="container-fluid">
	  <div class="row">
	    <!-- For Uploading an Image -->
	    
	    <!-- For Scanning A Picture -->
	    <div class="col-sm">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#scanAnImage">
				Scan an Image
			</button>
      <div class="modal fade" id="scanAnImage" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalCenterTitle">Scan A Picture Here</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
            </div>
            <div class="modal-body">
              <img src="{{ url_for('video_feed')}}" width = "400px" height="320px" id="player">
              <canvas id="canvas" width=100 height=100></canvas>
            </div>
            <div class="modal-footer ">
              <a href="#" id="extractor" onclick="extract()" download="digit.png"><button type="button " id="capture" class="btn btn-primary ">Snap!</button></a>
              
            </div>
          </div>
        </div>
      </div>
    </div>
	  </div>
	</div>
	<script>
              	  const player = document.getElementById('player');
				  const canvas = document.getElementById('canvas');
				  const context = canvas.getContext('2d');
				  const captureButton = document.getElementById('capture');

				  const constraints = {
				    video: true,
				  };

				  captureButton.addEventListener('click', () => {
				    context.drawImage(player, 0, 0, canvas.width, canvas.height);
				    player.srcObject.getVideoTracks().forEach(track => track.stop());
				  });

				  // Attach the video stream to the video element and autoplay.
				  navigator.mediaDevices.getUserMedia(constraints)
				    .then((stream) => {
				      player.srcObject = stream;
				    }).catch(e =>{
				      console.log(e);
				      /* handle the error */
				    if (err.name=="NotFoundError " || err.name == "DevicesNotFoundError " ){
				        //required track is missing
				    } else if (err.name=="NotReadableError " || err.name == "TrackStartError " ){
				         //webcam or mic are already in use
				    } else if (err.name=="OverconstrainedError " || err.name == "ConstraintNotSatisfiedError " ){
				        //constraints can not be satisfied by avb. devices
				    } else if (err.name=="NotAllowedError " || err.name == "PermissionDeniedError " ){
				        //permission denied in browser
				    } else if (err.name=="TypeError " || err.name == "TypeError " ){
				        //empty constraints object       
				    } else {
				         //other errors
				    }
				    });
				    function extract(){
				      // document.getElementById("ext ").download = "image.png "
				      // document.getElementById("downloader ").href = document.getElementById("canvas ").toDataURL("image/png ").replace(/^data:image\/[^;]/, 'data:application/octet-stream');
				      var button = document.getElementById('extractor');
				      button.addEventListener('click', function(e){
				        var dataURL = canvas.toDataURL('image/png');
				        button.href = dataURL;
				      })
				    }
              </script>



{% endblock %}
